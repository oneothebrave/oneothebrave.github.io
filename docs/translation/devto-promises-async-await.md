::: tip

æœ¬ç¯‡æ–‡ç« æ˜¯æ€€ç€èµè®¸ä¸å°Šæ•¬ä»[Lydia Hallie](https://dev.to/lydiahallie)çš„æ–‡ç« ä¸­ç¿»è¯‘è€Œæ¥çš„ï¼Œ[åŸæ–‡](https://dev.to/lydiahallie/javascript-visualized-promises-async-await-5gke)å†™çš„å®åœ¨æ˜¯å¤ªæ€§æ„Ÿäº†

:::

ä½ æ˜¯å¦æœ‰è¿‡è¿™æ ·çš„ç»å†ï¼Œè·‘ä¸€æ®µJSä»£ç ï¼Œä½†å®ƒå°±æ˜¯ä¸æŒ‰ä½ é¢„æœŸåœ°è¿è¡Œï¼Ÿçœ‹èµ·æ¥å°±åƒæ˜¯ä¸€äº›å‡½æ•°è¢«éšæœºåœ°ï¼Œåœ¨ä¸å¯é¢„æµ‹çš„æ—¶é—´è¢«æ‰§è¡Œäº†ï¼Œæˆ–è€…æ‰§è¡Œè¢«å»¶è¿Ÿäº†ã€‚é‚£ä½ å¯èƒ½æ­£åœ¨ä¸ES6å¼•å…¥çš„æ–°ç‰¹æ€§æ‰“äº¤é“ï¼š**Promise** . ä¸­æ–‡è¯‘åï¼šæœŸçº¦

Promiseæ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆè¦ç”¨å®ƒï¼Ÿå®ƒåˆ°åº•æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿå¦‚ä½•ä½¿ç”¨å®ƒ?

å¾€ä¸‹çœ‹ä¹‹å‰æœ€å¥½å…ˆçœ‹çœ‹[*äº‹ä»¶å¾ªç¯*](/translation/devto-jseventloop) çš„åŸç†. å¦‚æœä½ è¿˜æ²¡çœ‹è¿‡.



## ä»‹ç»

åœ¨ç¼–å†™JavaScriptæ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¸å¾—ä¸å¤„ç†ä¾èµ–äºå…¶ä»–ä»»åŠ¡çš„ä»»åŠ¡ï¼å‡è®¾æˆ‘ä»¬æƒ³è¦è·å–ä¸€å¼ å›¾åƒï¼Œå¯¹å…¶è¿›è¡Œå‹ç¼©ï¼Œåº”ç”¨è¿‡æ»¤å™¨ï¼Œç„¶åå°†å…¶ä¿å­˜ã€‚

æˆ‘ä»¬éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯è·å–æˆ‘ä»¬æƒ³è¦ç¼–è¾‘çš„å›¾åƒã€‚*getImage* å‡½æ•°å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼åªæœ‰åœ¨æˆåŠŸåŠ è½½è¯¥å›¾åƒä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½å°†è¯¥å€¼ä¼ é€’ç»™ *resizeImage* å‡½æ•°ã€‚å½“å›¾åƒæˆåŠŸè°ƒæ•´å¤§å°æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ *applyFilter* å‡½æ•°ä¸­å¯¹å›¾åƒåº”ç”¨è¿‡æ»¤å™¨ã€‚åœ¨å‹ç¼©å›¾åƒå¹¶æ·»åŠ ç­›é€‰å™¨åï¼Œæˆ‘ä»¬å¸Œæœ›ä¿å­˜å›¾åƒå¹¶è®©ç”¨æˆ·çŸ¥é“ä¸€åˆ‡å·¥ä½œæ­£å¸¸ï¼

æœ€åï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š

![PAA-1](../images/PAA-1.png)

è™½ç„¶è¿™ä¹ˆåšä¹Ÿå¯ä»¥ï¼Œä½†æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†è®¸å¤šåµŒå¥—çš„å›è°ƒå‡½æ•°ï¼Œå®ƒä»¬ä¾èµ–äºå‰é¢çš„å›è°ƒå‡½æ•°ï¼Œè¿™ç®€ç›´æ˜¯å›è°ƒåœ°ç‹±ï¼Œè¿™æ ·çš„ä»£ç å¾ˆéš¾æ‡‚ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€‚

å¹¸è¿çš„æ˜¯ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†Promiseï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆæ˜¯Promissï¼Œä»¥åŠå®ƒåœ¨è¿™æ ·çš„æƒ…å†µä¸‹å¯ä»¥å¦‚ä½•å¸®åŠ©æˆ‘ä»¬ï¼



## Promiseè¯­æ³•

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ¥å—å›è°ƒå‡½æ•°çš„ *Promiseæ„é€ å‡½æ•°* æ¥åˆ›å»º *Promise* :

![PAA-2](../images/PAA-2.gif)

ç­‰ç­‰ï¼Œè¿™æ˜¯è¿”å›äº†ä¸ªä»€ä¹ˆç©æ„å„¿ï¼Ÿ

***Promise*** æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ç€ä¸€ä¸ª **status**([[PromiseStatus]]) å±æ€§å’Œä¸€ä¸ª **value**([[PromiseValue]])å±æ€§ã€‚ä»ä¸Šé¢çš„åŠ¨å›¾ä¸­ä½ å¯ä»¥çœ‹è§ *[[PromiseStatus]]* çš„å€¼ä¸º "pending"ï¼Œ*Promise* çš„å€¼ä¸º *undefined* .

åˆ«æ‹…å¿ƒ--ä½ ä¸æ°¸è¿œä¸å¿…ä¸æ­¤å¯¹è±¡äº¤äº’ï¼Œç”šè‡³ä¸èƒ½è®¿é—®[[PromiseStatus]]å’Œ[[PromiseValue]]å±æ€§ï¼ä½†æ˜¯ï¼Œåœ¨ä½¿ç”¨Promisesæ—¶ï¼Œè¿™äº›å±æ€§çš„å€¼å¾ˆé‡è¦ã€‚

::: tip

è¯‘è€…æ³¨ï¼šæœŸçº¦çš„çŠ¶æ€æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½ç›´æ¥é€šè¿‡ JavaScript æ£€æµ‹åˆ°ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…æ ¹æ®è¯»å–åˆ°çš„æœŸçº¦çŠ¶æ€ï¼Œä»¥åŒæ­¥æ–¹å¼å¤„ç†æœŸçº¦å¯¹è±¡ã€‚å¦å¤–ï¼ŒæœŸçº¦çš„çŠ¶æ€ä¹Ÿä¸èƒ½è¢«å¤–éƒ¨ JavaScript ä»£ç ä¿®æ”¹ã€‚è¿™ä¸ä¸èƒ½è¯»å–è¯¥çŠ¶æ€çš„åŸå› æ˜¯ä¸€æ ·çš„ï¼šæœŸçº¦æ•…æ„å°†å¼‚æ­¥è¡Œä¸ºå°è£…èµ·æ¥ï¼Œä»è€Œéš”ç¦»å¤–éƒ¨çš„åŒæ­¥ä»£ç 

:::

*Promise* çš„çŠ¶æ€[[PromiseStatus]]æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š

- â³  *pending* : promiseæ—¢æ²¡æœ‰è¢«å…‘ç°(fulfilled)ï¼Œä¹Ÿæ²¡æœ‰è¢«æ‹’ç»(rejected) , promiseä¾æ—§æ‚¬è€Œæœªå†³
- âœ…  *fulfilled* ï¼špromiseå·²ç»è¢«å…‘ç°(fulfilled)ï¼Œä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œæ²¡æœ‰å‘ç”Ÿä»»ä½•é”™è¯¯
- âŒ  *rejected* : promiseå·²ç»è¢«æ‹’ç»(rejected), ä»€ä¹ˆäº‹æƒ…å‡ºé”™äº†

> è¯‘è€…ä¸¾ä¾‹å­ï¼šæƒ³è±¡ä½ å«äº†ä¸€è¾†æ»´æ»´ï¼ŒæŠŠä»å¹³å°æ¥å•åˆ°å¸æœºæŠŠä½ é€åˆ°ç›®çš„åœ°å½“åšä¸€ä¸ªPromise,å°±æ˜¯ä½ å’Œå¹³å°ç«‹ä¸‹ä¸€ä¸ªæœŸçº¦ï¼Œçº¦å®šåœ¨é‚£ä¸ªæ—¶é—´æ®µå†…ï¼Œå¹³å°æ´¾è½¦æŠŠä½ é€åˆ°ç›®çš„åœ°ã€‚
>
> åœ¨ä½ ä¸‹å•åï¼Œç›´åˆ°ä½ è¢«é€åˆ°ç›®çš„åœ°å‰ï¼Œè¿™ä¸ªçŠ¶æ€éƒ½ä¸€ç›´æ˜¯ *pending*ï¼Œ å› ä¸ºä½ è¿˜æ²¡æœ‰åˆ°ç›®çš„åœ°(promiseè¿˜æ²¡æœ‰è¢«å…‘ç°)ï¼Œä½ ä¹Ÿæ²¡æœ‰"åˆ°ä¸äº†ç›®çš„åœ°"(promiseè¿˜æ²¡æœ‰å‡ºé”™)
>
> ç„¶åæ¥ä¸‹æ¥ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š
>
> 1. ä½ è¢«å®‰å…¨åœ°é€åˆ°äº†ç›®çš„åœ°ï¼Œpromiseè¢«å…‘ç°ï¼ŒçŠ¶æ€æ”¹æˆfulfilled
>
> 2. å¸æœºæ¥åˆ°ç”µè¯ï¼Œè¯´ä»–è€å©†çªç„¶è¦ç”Ÿå­©å­äº†ï¼Œå¸æœºä½œä¸ºä¸€ä¸ªå¥½ç”·äººï¼Œå†³å®šè¦å»åŒ»é™¢ï¼Œä¸å»æ¥ä½ äº†ï¼Œå–æ¶ˆäº†è®¢å•ã€‚
>
>    æˆ–è€…å¸æœºçªç„¶å‘ç°ä»–æ²¡è€å©†ï¼Œä½†æ˜¯ä»–å¼€çš„æ˜¯æŸåº¦é€ çš„è½¦ï¼ŒåŠè·¯ç»™ä½ å¸¦åˆ°è†ç”°ç³»åŒ»é™¢å»äº†ç­‰ç­‰ç­‰ç­‰ï¼Œæ€»ä¹‹å°±æ˜¯å‡ºç°é—®é¢˜äº†ï¼Œé‚£ä¹ˆpromiseçš„çŠ¶æ€å°±æˆäº†rejectedï¼Œå› ä¸ºpromiseæ²¡æœ‰è¢«å®Œæˆã€‚

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°ä¼ äº†ä¸€ä¸ªå›è°ƒå‡½æ•° `() => {}` ç»™ *Promise* æ„é€ å™¨ã€‚ç„¶è€Œï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å®é™…ä¸Šæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°å¸¸å¸¸è¢«ç§°ä½œ `resolve` æˆ–è€… `res` , æ˜¯å½“ *Promise* çš„çŠ¶æ€åº”å½“æ”¹ä¸º *fulfilled* æ—¶è§¦å‘ã€‚ç¬¬äºŒä¸ªå‚æ•°å¸¸å¸¸è¢«ç§°ä½œ `reject` æˆ–è€… `rej` , æ˜¯å½“ *Promise* çš„çŠ¶æ€åº”å½“æ”¹ä¸º *reject* æ—¶è§¦å‘ï¼Œè¡¨ç¤ºæœ‰ä»€ä¹ˆä¸œè¥¿å‡ºé”™äº†

![PAA-3](../images/PAA-3.png)

è®©æˆ‘çœ‹çœ‹è°ƒç”¨ `resolve` æˆ–è€…`reject` æ–¹æ³•æ—¶ä¼šè¾“å‡ºä»€ä¹ˆï¼š

![PAA-4](../images/PAA-4.gif)

ä¸é”™ï¼æˆ‘ä»¬ç»ˆäºçŸ¥é“å¦‚ä½•æ‘†è„± *pending* çŠ¶æ€å’Œ *undefined* å€¼ï¼å¦‚æœæˆ‘ä»¬è°ƒç”¨äº† `res` å‡½æ•°ï¼Œé‚£ä¹ˆ *promise* çš„çŠ¶æ€å°±æ˜¯ "fulfilled"ï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨äº†`rej` å‡½æ•°ï¼Œé‚£ä¹ˆ *promise* çš„çŠ¶æ€å°±æ˜¯"rejected"ã€‚è€Œ*promise* çš„å€¼ï¼Œæ—¢[[PromiseValue]]çš„å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬ä¼ ç»™ `res` æˆ–è€…`rej`çš„å€¼ã€‚

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯¹å¦‚ä½•æ§åˆ¶é‚£ä¸ªæ¨¡ç³Šçš„ *Promise* å¯¹è±¡æœ‰äº†æ›´å¤šçš„äº†è§£ã€‚ä½†æ˜¯å®ƒæ˜¯ç”¨æ¥åšä»€ä¹ˆçš„å‘¢ï¼Ÿ

åœ¨ä»‹ç»éƒ¨åˆ†ä¸­ï¼Œæˆ‘å±•ç¤ºäº†ä¸€ä¸ªç¤ºä¾‹ï¼Œåœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è·å–å›¾åƒã€å‹ç¼©å®ƒã€åº”ç”¨è¿‡æ»¤å™¨ï¼Œå¹¶ä¿å­˜å®ƒï¼æœ€ç»ˆï¼Œè¿™å˜æˆäº†ä¸€ä¸ªç–¯ç‹‚åµŒå¥—å›è°ƒçš„ä¹±ä¸ƒå…«ç³Ÿçš„å±€é¢ã€‚

å¹¸è¿çš„æ˜¯ï¼Œ*Promise* å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼é¦–å…ˆï¼Œè®©æˆ‘ä»¬é‡å†™æ•´ä¸ªä»£ç å—ï¼Œä»¥ä¾¿æ¯ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª *Promise*ã€‚

å¦‚æœå›¾åƒå·²åŠ è½½ï¼Œå¹¶ä¸”ä¸€åˆ‡æ­£å¸¸ï¼Œé‚£å°±è°ƒç”¨`res`æ¥å¤„ç†promiseå§ï¼å¦åˆ™ï¼Œå¦‚æœåœ¨åŠ è½½æ–‡ä»¶æ—¶å‡ºç°é”™è¯¯ï¼Œé‚£å°±è°ƒç”¨`rej`æ¥å¤„ç†promiseå§.![PAA-5](../images/PAA-5.png)

è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­è¿è¡Œè¿™æ®µä»£ç æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼

![PAA-6](../images/PAA-6.gif)

æ£’ï¼æ­£å¦‚æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼Œè¿”å›äº†ä¸€ä¸ªpromiseï¼Œå…¶ä¸­åŒ…å«å·²è§£ææ•°æ®çš„å€¼ã€‚

ç„¶åå‘¢ï¼Ÿæˆ‘ä»¬ä¸å…³å¿ƒæ•´ä¸ªPromiseå¯¹è±¡ï¼Œæˆ‘ä»¬åªå…³å¿ƒæ•°æ®çš„å€¼ï¼å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€äº›å†…ç½®çš„æ–¹æ³•å¯ä»¥è·å¾—promiseçš„å€¼ã€‚å¯¹äºpromiseï¼Œæˆ‘ä»¬å¯ä»¥é™„åŠ 3ç§æ–¹æ³•ï¼š

- `.then()`: åœ¨promiseæ‰§è¡Œ`resolve`ä¹‹åè¢«æ‰§è¡Œ
- `.catch()`: åœ¨promiseæ‰§è¡Œ`reject`ä¹‹åè¢«æ‰§è¡Œ
- `.finally()`: æ— è®ºpromiseæ‰§è¡Œ`resolve`æˆ–è€…æ˜¯`reject`ï¼Œéƒ½ä¼šè¢«æ‰§è¡Œ

![PAA-7](../images/PAA-7.png)

`.then`æ–¹æ³•æ¥å—ä¼ é€’ç»™`resolve`æ–¹æ³•çš„å€¼

![PAA-8](../images/PAA-8.gif)

`.catch`æ–¹æ³•æ¥å—ä¼ é€’ç»™`reject`æ–¹æ³•çš„å€¼

![PAA-9](../images/PAA-9.gif)

ç»ˆäºï¼Œæˆ‘ä»¬å¾—åˆ°äº†åœ¨æ²¡æœ‰æ•´ä¸ªPromiseå¯¹è±¡çš„æƒ…å†µä¸‹ç”±Promiseç”Ÿæˆçš„å€¼ï¼æˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨è¿™ä¸ªå€¼åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚



------



ä»…ä¾›å‚è€ƒï¼Œå½“æ‚¨çŸ¥é“promiseå°†å§‹ç»ˆ`resolve`æˆ–å§‹ç»ˆ`reject`æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¦rejectæˆ–resolve promiseçš„å€¼ç¼–å†™Promise.resolveæˆ–Promise.rejectï¼ï¼ˆç¿»è¯‘ä¸æ˜ç™½ï¼Œå¤ªéš¾ç¿»è¯‘äº†ï¼Œè¿˜æ˜¯çœ‹å›¾å§ï¼‰

![PAA-10](../images/PAA-10.png)

æ¥ä¸‹æ¥ä½ ä¼šç»å¸¸çœ‹åˆ°è¿™ç§è¯­æ³•



------



åœ¨*getImage*ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ€ç»ˆä¸å¾—ä¸åµŒå¥—å¤šä¸ªå›è°ƒæ‰èƒ½è¿è¡Œå®ƒä»¬ã€‚å¹¸è¿çš„æ˜¯ï¼Œ`.then` å¤„ç†ç¨‹åºå¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼

`.then` æ–¹æ³•æœ¬èº«çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªpromiseå€¼(æ³¨æ„æ˜¯è¿”å›å€¼å“¦ï¼Œä¼ ç»™ *.then* çš„æ˜¯promise çš„valueï¼Œä¸æ˜¯promise)ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é“¾æ¥ä»»æ„å¤šä¸ª`.then`ï¼šå‰ä¸€ä¸ª*then*å›è°ƒçš„ç»“æœå°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸‹ä¸€ä¸ª*then*å›è°ƒï¼

![PAA-11](../images/PAA-11.png)

åœ¨*getImage*ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é“¾æ¥å¤šä¸ª*then*å›è°ƒï¼Œä»¥ä¾¿å°†å¤„ç†åçš„å›¾åƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ï¼æˆ‘ä»¬å¾—åˆ°çš„ä¸æ˜¯è®¸å¤šåµŒå¥—çš„å›è°ƒï¼Œè€Œæ˜¯ä¸€ä¸ªå¹²å‡€çš„*then*é“¾ã€‚

![PAA-12](../images/PAA-12.png)

å®Œç¾ï¼è¿™ä¸ªå†™æ³•å¯æ¯”ä¹‹å‰çš„å¥½å¤šäº†



------



## ï¼ˆå®ï¼‰ä»»åŠ¡é˜Ÿåˆ—å’Œå¾®ä»»åŠ¡é˜Ÿåˆ—



ç°åœ¨æˆ‘ä»¬å¯¹å¦‚ä½•åˆ›é€  *promise* ä»¥åŠå¦‚ä½•ä» *promise* ä¸­æå–å€¼æœ‰äº†æ›´å¤šçš„äº†è§£ã€‚è®©æˆ‘ä»¬å†å‘è„šæœ¬ä¸­æ·»åŠ ä¸€äº›ä»£ç ï¼Œç„¶åå†æ¬¡è¿è¡Œå®ƒï¼š

![PAA-13](../images/PAA-13.gif)

ç­‰ç­‰ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼ğŸ¤¯

é¦–å…ˆï¼Œâ€œStart!â€ è¢«æ‰“å°å‡ºæ¥ï¼Œè¿™ä¸ªæ²¡é—®é¢˜ã€‚ç„¶è€Œç¬¬äºŒä¸ªè¢«æ‰“å°å‡ºæ¥çš„å€¼å±…ç„¶æ˜¯ "End!" ï¼Œè€Œä¸æ˜¯promiseçš„resolveçš„å€¼ï¼Œ"Promise!" æœ€åæ‰è¢«æ‰“å°å‡ºæ¥ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

æˆ‘ä»¬ç»ˆäºçœ‹åˆ°äº† *promise* çš„çœŸæ­£åŠ›é‡ï¼è™½ç„¶JavaScriptæ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ *promise* æ·»åŠ å¼‚æ­¥è¡Œä¸ºï¼



------



ç­‰ä¸€ä¸‹ï¼Œæˆ‘[äº‹ä»¶å¾ªç¯](/translation/devto-jseventloop)å‘¢?éš¾é“æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿçš„æ–¹æ³•(å¦‚setTimeout)æ¥åˆ›å»ºæŸç§å¼‚æ­¥è¡Œä¸ºå—ï¼Ÿ

å½“ç„¶å¯ä»¥ï¼ä¸è¿‡ï¼Œåœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œå…¶å®æœ‰ä¸¤ç§ç±»å‹çš„é˜Ÿåˆ—ï¼š**ï¼ˆå®ï¼‰ä»»åŠ¡é˜Ÿåˆ—** å’Œ **å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼Œï¼ˆå®ï¼‰ä»»åŠ¡é˜Ÿåˆ—ç”¨äºï¼ˆå®ï¼‰ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—ç”¨äºå¾®ä»»åŠ¡ã€‚

é‚£ä¹ˆä»€ä¹ˆæ˜¯ï¼ˆå®ï¼‰ä»»åŠ¡ï¼Œä»€ä¹ˆåˆæ˜¯å¾®ä»»åŠ¡å‘¢ï¼Ÿå¸¸è§çš„å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼ŒåŒ…æ‹¬ä½†ä¸é™äº

|   ç§ç±»    |                           ä»»åŠ¡                           |
| :-------: | :------------------------------------------------------: |
| (å®ï¼‰ä»»åŠ¡ |       setTimeout` | `setInterval` | `setImmediate        |
|  å¾®ä»»åŠ¡   | Promise callback` | `process.nextTick` | `queueMicrotask |

å•Šï¼Œæˆ‘ä»¬åœ¨å¾®ä»»åŠ¡åˆ—è¡¨ä¸­çœ‹åˆ°äº†Promiseï¼å½“Promiseè°ƒç”¨å…¶`then()`ã€`catch()`æˆ–`finally()`æ–¹æ³•æ—¶ï¼Œæ–¹æ³•ä¸­çš„å›è°ƒè¢«æ·»åŠ åˆ°å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼è¿™æ„å‘³ç€`then()`ã€`catch()`æˆ–`finally()`æ–¹æ³•ä¸­çš„å›è°ƒä¸ä¼šç«‹å³æ‰§è¡Œï¼Œå®è´¨ä¸Šæ˜¯å‘æˆ‘ä»¬çš„JavaScriptä»£ç æ·»åŠ äº†ä¸€äº›å¼‚æ­¥è¡Œä¸ºï¼

é‚£ä¹ˆ`then()`ã€`catch()`æˆ–`finally()`æ–¹æ³•ä¸­çš„å›è°ƒå‡½æ•°æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„å‘¢ï¼Ÿäº‹ä»¶å¾ªç¯ä¸ºä»»åŠ¡èµ‹äºˆä¸åŒçš„ä¼˜å…ˆçº§ï¼š

1. æ‰§è¡Œå½“å‰åœ¨è°ƒç”¨å †æ ˆä¸­çš„æ‰€æœ‰å‡½æ•°ã€‚å½“å®ƒä»¬è¿”å›å€¼æ—¶ï¼Œå®ƒä»¬ä¼šä»å †æ ˆä¸­å¼¹å‡ºã€‚
2. å½“è°ƒç”¨å †æ ˆä¸ºç©ºæ—¶ï¼Œæ‰€æœ‰æ’é˜Ÿçš„å¾®ä»»åŠ¡å°†é€ä¸ªå¼¹å‡ºåˆ°è°ƒç”¨å †æ ˆä¸Šï¼Œå¹¶è¢«æ‰§è¡Œï¼(å¾®ä»»åŠ¡æœ¬èº«ä¹Ÿå¯ä»¥è¿”å›æ–°çš„å¾®ä»»åŠ¡ï¼Œæœ‰æ•ˆåœ°åˆ›å»ºäº†ä¸€ä¸ªæ— é™çš„å¾®ä»»åŠ¡å¾ªç¯)
3. å¦‚æœè°ƒç”¨å †æ ˆå’Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½ä¸ºç©ºï¼Œäº‹ä»¶å¾ªç¯å°±ä¼šæ£€æŸ¥(å®)ä»»åŠ¡é˜Ÿåˆ—ä¸Šæ˜¯å¦æœ‰å‰©ä½™çš„ä»»åŠ¡ã€‚ç„¶åï¼ˆå®ï¼‰ä»»åŠ¡è¢«å¼¹å‡ºåˆ°è°ƒç”¨å †æ ˆä¸Šï¼Œæ‰§è¡Œï¼Œç„¶åå¼¹å‡ºï¼



------



è®©æˆ‘ä»¬å¿«é€Ÿæ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

- *Task1* : ä¸€ä¸ªç«‹å³æ·»åŠ åˆ°è°ƒç”¨å †æ ˆä¸­çš„å‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­å¯ä»¥ç«‹å³è°ƒç”¨å®ƒã€‚
- *Task2, Task3, Task4* ï¼šå¾®ä»»åŠ¡ä»¬ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªpromiseçš„`then`å›è°ƒå‡½æ•°ï¼Œæˆ–è€…ä½¿ç”¨ *queneMicrotask* æ·»åŠ çš„ä»»åŠ¡
- *Task5ï¼Œ Task6* : ä¸€ä¸ª(å®)ä»»åŠ¡é˜Ÿåˆ—, ä¾‹å¦‚ï¼Œ*setTimeout* å’Œ *setImmediate* çš„å›è°ƒå‡½æ•°

![PAA-15](../images/PAA-15.gif)



é¦–å…ˆï¼Œ*Task1*è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä»è°ƒç”¨å †æ ˆä¸­å¼¹å‡ºã€‚ç„¶åï¼Œå¼•æ“æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿçš„ä»»åŠ¡ã€‚ä¸€æ—¦æ‰€æœ‰ä»»åŠ¡éƒ½è¢«æ”¾å…¥è°ƒç”¨å †æ ˆå¹¶æœ€ç»ˆå¼¹å‡ºï¼Œå¼•æ“å°±ä¼šæ£€æŸ¥(å®)ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡è¢«æ¨åˆ°è°ƒç”¨å †æ ˆä¸Šï¼Œå¹¶åœ¨å®ƒä»¬è¿”å›å€¼æ—¶è¢«å¼¹å‡ºã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œäº‹ä»¶æ‰§è¡Œçš„ä¼˜å…ˆçº§é¡ºåºä¸ºï¼š**åŒæ­¥å‡½æ•° > å¾®ä»»åŠ¡(ä¸è¿›å…¥Web API) > (å®)ä»»åŠ¡**

ç°åœ¨æˆ‘ä»¬ç”¨ä¸€äº›çœŸæ­£çš„ä»£ç æ¥ä½¿ç”¨å®ƒï¼

![PAA-16](../images/PAA-16.png)

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬æœ‰å®ä»»åŠ¡*setTimeout*å’Œå¾®ä»»åŠ¡Promise *then()*å›è°ƒã€‚ä¸€æ—¦å¼•æ“åˆ°è¾¾setTimeoutå‡½æ•°è¡Œã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°è¿è¡Œè¿™æ®µä»£ç ï¼Œçœ‹çœ‹è®°å½•äº†ä»€ä¹ˆï¼

åœ¨ç¬¬ä¸€è¡Œï¼Œå¼•æ“é‡åˆ°console.log()æ–¹æ³•ã€‚å®ƒè¢«æ·»åŠ åˆ°è°ƒç”¨å †æ ˆï¼Œä¹‹åæ‰“å°å‡ºå€¼*startï¼*åˆ°æ§åˆ¶å°ã€‚è¯¥æ–¹æ³•ä»è°ƒç”¨å †æ ˆä¸­å¼¹å‡ºï¼Œå¼•æ“ç»§ç»­ã€‚

![PAA-17](../images/PAA-17.gif)

æ¥ç€å¼•æ“é‡åˆ°*setTimeout*æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¢«æ¨åˆ°è°ƒç”¨å †æ ˆã€‚*setTimeout*æ–¹æ³•æ˜¯æµè§ˆå™¨åŸç”Ÿçš„ï¼šå®ƒçš„å›è°ƒå‡½æ•°`()=>console.log(â€˜in timeoutâ€™)`å°†è¢«æ·»åŠ åˆ°Web API(æ­¤æ—¶*setTimeout*å·²ç»è¿”å›äº†å€¼ï¼Œè¢«å¼¹å‡ºå †æ ˆ)ï¼Œç›´åˆ°è®¡æ—¶å™¨ç»“æŸã€‚å°½ç®¡æˆ‘ä»¬ä¸ºè®¡æ—¶å™¨æä¾›äº†å€¼0ï¼Œä½†æ˜¯å›è°ƒä»ç„¶é¦–å…ˆè¢«æ¨é€åˆ°Web APIï¼Œç„¶åè¢«æ·»åŠ åˆ°(å®)ä»»åŠ¡é˜Ÿåˆ—ï¼š*setTimeout*æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼

![PAA-18](../images/PAA-18.gif)

ç»§ç»­ï¼Œå¼•æ“é‡åˆ°*Promise.resolve()*æ–¹æ³•ã€‚*Promise.resolve()*æ–¹æ³•è¢«æ·»åŠ åˆ°è°ƒç”¨å †æ ˆä¸­ï¼Œafter which is resolves with the value `Promise!`. Its `then` callback function gets added to the **microtask queue**.ï¼ˆç¿»è¯‘ä¸æ¥ï¼Œè‡ªå·±ç†è§£ï¼‰

![PAA-19](../images/PAA-19.gif)

å¾€ä¸‹ï¼Œå¼•æ“é‡åˆ°console.log()æ–¹æ³•ã€‚å®ƒä¼šç«‹å³æ·»åŠ åˆ°è°ƒç”¨å †æ ˆä¸­ï¼Œç„¶åæ‰“å°å‡ºå€¼*Endï¼*åˆ°æ§åˆ¶å°ï¼Œä»è°ƒç”¨å †æ ˆä¸­å¼¹å‡ºï¼Œå¼•æ“ç»§ç»­ã€‚

![PAA-20](../images/PAA-20.gif)

ç´§æ¥ç€ï¼Œå¼•æ“å‘ç°è°ƒç”¨å †æ ˆç°åœ¨ä¸ºç©ºã€‚ç”±äºè°ƒç”¨å †æ ˆä¸ºç©ºï¼Œå®ƒå°†æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰æ’é˜Ÿçš„ä»»åŠ¡ï¼æ˜¯çš„ï¼Œç¡®å®æœ‰ï¼Œpromiseçš„ *then* å›è°ƒå‡½æ•°å·²ç»è¿«ä¸åŠå¾…äº†ï¼å®ƒè¢«æ¨å…¥è¿›è°ƒç”¨å †æ ˆä¸­ï¼Œç„¶åè¾“å‡ºPromiseçš„resolvedçš„å€¼ï¼šåœ¨æœ¬ä¾‹ä¸­æ˜¯å­—ç¬¦ä¸²`Promiseï¼`

![PAA-21](../images/PAA-21.gif)

å¼•æ“å‘ç°è°ƒç”¨å †æ ˆä¸ºç©ºï¼Œå› æ­¤å®ƒå°†å†æ¬¡æ£€æŸ¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä»¥æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰ä»»åŠ¡åœ¨æ’é˜Ÿã€‚ä¸ï¼Œå¾®ä»»åŠ¡é˜Ÿåˆ—éƒ½æ˜¯ç©ºçš„ã€‚

ç°åœ¨æ˜¯æ£€æŸ¥(å®)ä»»åŠ¡é˜Ÿåˆ—çš„æ—¶å€™äº†ï¼š*setTimeout*å›è°ƒä»åœ¨é‚£é‡Œç­‰å¾…ï¼*setTimeout*å›è°ƒè¢«æ¨å…¥è¿›è°ƒç”¨å †æ ˆã€‚å›è°ƒå‡½æ•°è¿”å›*console.log*æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è®°å½•å­—ç¬¦ä¸²`â€œIn Timeoutï¼â€`ã€‚*setTimeout*å›è°ƒä»è°ƒç”¨å †æ ˆä¸­å¼¹å‡ºã€‚

![PAA-22](../images/PAA-22.gif)

ç»ˆäºå®Œæˆäº†ï¼çœ‹èµ·æ¥ä¹Ÿå°±é‚£ä¹ˆäº¿ç‚¹ç‚¹å¤æ‚å˜›.



------



## Async / Await

ES7å¼•å…¥äº†ä¸€ç§æ–°çš„æ–¹å¼æ¥åœ¨JavaScriptä¸­æ·»åŠ å¼‚æ­¥è¡Œä¸ºï¼Œå¹¶ä½¿å¾—ä½¿ç”¨ *Promise* å˜å¾—æ›´å®¹æ˜“ï¼é€šè¿‡å¼•å…¥*async*å’Œ*await*å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºéšå¼è¿”å›æ‰¿è¯ºçš„å¼‚æ­¥å‡½æ•°ã€‚ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆèƒ½åšåˆ°è¿™ä¸€ç‚¹å‘¢ï¼Ÿã€‚

åœ¨å‰é¢ï¼Œæˆ‘ä»¬çœ‹åˆ°å¯ä»¥ä½¿ç”¨*Promise*å¯¹è±¡æ˜¾å¼åˆ›å»ºæ‰¿è¯ºï¼Œæ— è®ºæ˜¯é€šè¿‡é”®å…¥`new Promise(()=>{})`ã€*Promise.resolve*è¿˜æ˜¯*Promise.reject*ã€‚

æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºéšå¼è¿”å›å¯¹è±¡çš„å¼‚æ­¥å‡½æ•°ï¼Œè€Œä¸æ˜¯æ˜¾å¼ä½¿ç”¨*Promise*å¯¹è±¡ï¼è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å†éœ€è¦è‡ªå·±ç¼–å†™ä»»ä½•*Promise*å¯¹è±¡ã€‚

![PAA-23](../images/PAA-23.png)

å°½ç®¡ *async* å‡½æ•°éšå¼è¿”å› *promises* çš„äº‹å®ä¸å¯ç½®å¦ï¼Œä½†åœ¨ä½¿ç”¨*await*å…³é”®å­—æ—¶ï¼Œæ‰å¯ä»¥çœ‹åˆ°*async*å‡½æ•°çš„çœŸæ­£å¨åŠ›ï¼ä½¿ç”¨*await*å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‚èµ·å¼‚æ­¥å‡½æ•°ï¼ŒåŒæ—¶ç­‰å¾…è¢« *await* çš„å€¼è¿”å›å·²è§£æçš„æ‰¿è¯ºã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦è·å¾—è¿™ä¸ªå·²è§£ææ‰¿è¯ºçš„å€¼ï¼Œå°±åƒæˆ‘ä»¬ä¹‹å‰å¯¹*then()*å›è°ƒæ‰€åšçš„é‚£æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å˜é‡èµ‹ç»™ç­‰å¾…çš„æ‰¿è¯ºå€¼ï¼

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æš‚åœå¼‚æ­¥åŠŸèƒ½ï¼Ÿå¥½çš„ï¼Œå¾ˆå¥½ï¼Œä½†æ˜¯..è¿™åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

è®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬è¿è¡Œä»¥ä¸‹ä»£ç å—æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼š

![PAA-24](../images/PAA-24.gif)

å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

![PAA-25](../images/PAA-25.gif)

é¦–å…ˆï¼Œå¼•æ“é‡åˆ°ä¸€ä¸ª`console.log`ã€‚å®ƒè¢«æ¨å…¥åˆ°è°ƒç”¨å †æ ˆä¸Šï¼Œæ‰“å°å‡º *Before function*ã€‚

![PAA-26](../images/PAA-26.gif)

ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨å¼‚æ­¥å‡½æ•°`myFunc()`ï¼Œç„¶åè¿è¡Œ*myFunc*çš„å‡½æ•°ä½“ã€‚åœ¨å‡½æ•°ä½“çš„ç¬¬ä¸€è¡Œï¼Œæˆ‘ä»¬è°ƒç”¨å¦ä¸€ä¸ª`console.log`ï¼Œæ‰“å°å‡º`InÂ function!`



------



![PAA-27](../images/PAA-27.gif)





å‡½æ•°ä½“ç»§ç»­è¢«æ‰§è¡Œï¼Œè¿™å°†æˆ‘ä»¬å¸¦åˆ°ç¬¬äºŒè¡Œã€‚æœ€åï¼Œæˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ª*await*å…³é”®å­—ï¼ã€‚

åœ¨è¿™é‡Œå‘ç”Ÿçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ‰§è¡Œ*await*åçš„å€¼ï¼šåœ¨è¿™é‡Œæ˜¯ *one* å‡½æ•°ã€‚å®ƒè¢«æ¨å…¥åˆ°è°ƒç”¨å †æ ˆä¸Šï¼Œå¹¶æœ€ç»ˆè¿”å›ä¸€ä¸ªå·²è§£æçš„æ‰¿è¯ºã€‚ä¸€æ—¦æ‰¿è¯ºè¢«è§£æå¹¶ä¸” *one* å‡½æ•°è¿”å›äº†å€¼ï¼Œå¼•æ“å°±ä¼šé‡åˆ°*await*å…³é”®å­—ã€‚**æ³¨æ„æ˜¯å…ˆæ‰§è¡Œç´§è·Ÿåœ¨awaitåçš„è¡¨è¾¾å¼ç„¶åå†æŒ‚èµ·asyncå‡½æ•°**ã€‚

å½“é‡åˆ°*await*å…³é”®å­—æ—¶ï¼Œ*async*å‡½æ•°è¢«æŒ‚èµ·ã€‚å‡½æ•°ä½“çš„æ‰§è¡Œæš‚åœï¼Œ*async*å‡½æ•°çš„å…¶ä½™éƒ¨åˆ†åœ¨å¾®ä»»åŠ¡ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨å¸¸è§„ä»»åŠ¡ä¸­è¿è¡Œï¼



------



![PAA-27](../images/PAA-28.gif)

ç°åœ¨*async*å‡½æ•°*myFunc*ç”±äºé‡åˆ°*await*å…³é”®å­—è€ŒæŒ‚èµ·ï¼Œå¼•æ“è·³å‡ºå¼‚æ­¥å‡½æ•°å¹¶ç»§ç»­åœ¨è°ƒç”¨å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç ï¼šåœ¨æœ¬ä¾‹ä¸­æ˜¯å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼



------



![PAA-29](../images/PAA-29.gif)

æœ€åï¼Œå·²ç»æ²¡æœ‰ä»»åŠ¡éœ€è¦åœ¨åœ¨å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œï¼äº‹ä»¶å¾ªç¯æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•å¾®ä»»åŠ¡åœ¨æ’é˜Ÿï¼šç¡®å®æœ‰ï¼å¼‚æ­¥*myFunc*å‡½æ•°åœ¨è§£æ*one*çš„å€¼åæ’é˜Ÿã€‚*myFunc*æ¨å…¥è°ƒç”¨å †æ ˆï¼Œå¹¶åœ¨ä¹‹å‰åœæ­¢çš„åœ°æ–¹ç»§ç»­è¿è¡Œã€‚

å˜é‡*res*æœ€ç»ˆè·å¾—å®ƒçš„å€¼ï¼Œå³promiseçš„`resolve`çš„å€¼ï¼æˆ‘ä»¬è°ƒç”¨`console.log`æ‰“å°å‡º*res*çš„å€¼ï¼šå­—ç¬¦ä¸²`one!`å¹¶ä»è°ƒç”¨å †æ ˆä¸­å¼¹å‡ºï¼ã€‚

ç»ˆäºï¼Œä¸€åˆ‡éƒ½å®Œæˆäº†ï¼ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œä¸*promise*ç›¸æ¯”ï¼Œ*async*åŠŸèƒ½æœ‰ä½•ä¸åŒï¼Ÿ*await*å…³é”®å­—æŒ‚èµ·å¼‚æ­¥å‡½æ•°ï¼Œè€Œå¦‚æœæˆ‘ä»¬å½“æ—¶ä½¿ç”¨äº†Promiseçš„`.then()`ï¼Œé‚£ä¹ˆPromiseå°†ç»§ç»­æ‰§è¡Œï¼



> ç¿»è¯‘åˆ°åé¢æ„Ÿè§‰ç¿»è¯‘åœ°ä¹±ä¸ƒå…«ç³Ÿçš„ã€‚é˜…è¯»åŸæ–‡ç§»æ­¥[è¿™é‡Œ](https://dev.to/lydiahallie/javascript-visualized-promises-async-await-5gke)